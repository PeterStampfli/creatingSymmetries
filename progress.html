<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8"/>
<head>
	<title>Progress</title>
</head>
<body>
	<svg id="progress" width="500" height="20">
	<rect id="progressBackground" width="500" height="20" style="fill:rgb(200,00,200)" />
	</svg>
	<p> 
		<canvas id="progressCanvas" moz-opaque></canvas>
	</p>
</body>
<script>
function time(){
	return (new Date().getTime())/1000;
}

function mess(){
	console.log("mess");
}

//x=setInterval(mess,100);


var progressCanvas;
var progressImage;
var progressWidth=500;
var progressHeight=20;
var progressBackground="rgb(200,200,200)";
var progressStroke="rgb(0,0,0)";
var progressColor="rgb(100,220,0)";
var progressIntervalID=0;
var progressTodo;
var progressCurrent=0;
var progressUpdateTimeInterval=0.2;

window.onload=function(){
    progressCanvas = document.getElementById("progressCanvas");
    progressImage = progressCanvas.getContext("2d");
    progressCanvas.width=progressWidth;
    progressCanvas.height=progressHeight;
    showProgress();
    test();

}


function showProgress(){
	progressImage.fillStyle=progressBackground;
	progressImage.fillRect(0,0,progressWidth,progressHeight);
	progressImage.fillStyle=progressColor;
	progressImage.fillRect(0,0,progressCurrent*progressWidth,progressHeight);
	progressImage.strokeStyle=progressStroke;
	progressImage.strokeRect(0,0,progressWidth,progressHeight);
	console.log("show");
}

function startProgress(todo){
	progressTodo=todo;
	progressStartTime=time();
	progressLastUpdateTime=progressStartTime;
	updateProgress(0);
	showProgress();
	progressIntervalID=setInterval(showProgress,100);

}

function updateProgress(done){
	progressCurrent=done/progressTodo;
	if (progressCurrent>=0.99){
		clearInterval(progressIntervalID);
	}
}

function test(){

	nCheck=10000000;

	x=0;
	dx=6.28/nCheck;
	start=time();
	startProgress(6.28);
	while(x<6.28){
		y=Math.sin(x);
		x+=dx;
		updateProgress(x);
	}
	console.log((time()-start));

	showProgress(1);
}

</script>
</html>
